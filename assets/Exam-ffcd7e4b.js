import{d as F,v,p as q,aU as U,e as E,w as a,A as O,aV as P,o as m,l as o,k as I,t as u,f as p,q as d,a as x,x as B,F as z,g,al as W,aW as X,aX as Y,aY as Z,a8 as J,E as K,aZ as ee,m as te}from"./index-90b969ab.js";import{E as se,Q as ae}from"./http-8e4e028d.js";import{b as ne,c as oe,E as le}from"./el-radio-group-158c4765.js";import{E as ie}from"./el-divider-10b87a93.js";import{E as re,a as me}from"./el-button-a1c979f6.js";import{E as ue,a as c,Q as _,b as de,_ as ce,c as D}from"./CountDown.vue_vue_type_script_setup_true_lang-70478b33.js";import{E as _e}from"./index-e3ad4857.js";import"./use-form-item-c74f1215.js";import"./index-3f25c50f.js";import"./scroll-def8f48a.js";import"./index-5b94a77c.js";import"./index-4acc60bd.js";import"./validator-f2e4259a.js";const pe={style:{margin:"5px"}},fe={class:"question-zone"},ye={style:{"padding-left":"10px","padding-top":"5px"}},ge={key:0,class:"answer"},we={key:1,class:"answer"},Ee={class:"question"},xe={key:0,class:"title"},be=F({__name:"Exam",setup(Ie){const b=X(),e=v(new ue);let y=v([[0,0]]);const Q=()=>{e.id=Number(b.query.id),e.state=c.IDLE,e.start_time=Date.now(),e.name=String(b.query.name),e.subjectId=Number(b.query.subjectId),e.subjectName=String(b.query.subjectName),e.exam_seconds=Number(b.query.exam_seconds),O.getQuestionListByQuizId(e.id).then(r=>{let s=r.data.results;e.meta=[{typeId:_.CHOICE,typeName:"选择",icon:"Message",qList:[]},{typeId:_.LOGIC,typeName:"判断",icon:"Setttings",qList:[]},{typeId:_.CODING,typeName:"编程",icon:"Menu",qList:[]}],e.scores=0,y=[];var l=0;s.forEach(n=>{y.push([n.type,e.meta[n.type].qList.length]),e.meta[n.type].qList.push({index:l++,id:n.id,type:n.type,title:n.title,description:n.description,image:n.image,answer:n.answer,displayType:"default",userAnswer:"未作答",score:n.score}),e.scores+=n.score}),e.state=c.ONGOING})},R=()=>{L()};q(()=>{Q()}),U((r,s,l)=>{if(e.state!=c.ONGOING){l();return}D.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(n=>{l(!1)}).catch(n=>{n=="cancel"?l():l(!1)})});const t=v({meta:new de,answers:["","",""]}),N=r=>{let s=e.meta[y[r][0]].qList[y[r][1]];t.meta=s,t.answers[t.meta.type]=s.userAnswer},G=()=>{if(t.meta.index>=0&&e.state==c.ONGOING){var r=y[t.meta.index][0],s=y[t.meta.index][1];e.meta[r].qList[s].userAnswer=t.answers[t.meta.type],e.meta[r].qList[s].displayType="primary"}},L=async()=>{var r=Number(localStorage.getItem("user_id")),s=new ae,l=0,n=[0,0,0];e.meta.forEach(C=>{C.qList.forEach(i=>{i.displayType=i.userAnswer==i.answer?"success":"danger",i.userAnswer==i.answer&&(s.meta.abs_score+=i.score,n[i.type]++),i.type!=_.CODING&&(l+=i.score,s.questions.push({user:r,question:i.id,is_correct:i.userAnswer==i.answer}))})}),s.meta.note=`选择: ${n[_.CHOICE]}/${e.meta[_.CHOICE].qList.length}, 判断: ${n[_.LOGIC]}/${e.meta[_.LOGIC].qList.length}`,s.meta.user=r,s.meta.quiz=e.id,s.meta.rel_score=Math.round(s.meta.abs_score*100/l),s.meta.use_minutes=Math.round((Date.now()-e.start_time)/1e3/60),await O.postQuestionsResult(s.questions),await O.postQuizResult(s.meta),e.state=c.FINISHED},T=()=>{D.confirm("确定提交并结束考试吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await L(),_e({type:"success",message:"Delete completed"})})};return(r,s)=>{const l=re,n=Y,C=ie,i=ne,V=Z,S=J("ArrowRight"),M=K,$=me,w=oe,k=le,H=se,j=ee,A=P;return m(),E(A,{class:"layout-container-exam",style:{height:"100%"}},{default:a(()=>[o(n,null,{default:a(()=>[I("span",null,"【"+u(e.subjectName)+"】"+u(e.name)+"【总分: "+u(e.scores)+"】",1),o(ce,{style:{color:"red"},start_flag:e.state==p(c).ONGOING,duration_secs:e.exam_seconds,blink:!0,start_text:"【考试剩余】",onEnd_event:R},null,8,["start_flag","duration_secs"]),o(l,{link:"",type:"primary",disabled:e.state!=p(c).ONGOING,onClick:T},{default:a(()=>[d("提交")]),_:1},8,["disabled"])]),_:1}),o(A,null,{default:a(()=>[o(V,{width:"170px"},{default:a(()=>[o(i,{style:{height:"100%"}},{default:a(()=>[(m(!0),x(z,null,B(e.meta,f=>(m(),x("div",pe,[o(C,null,{default:a(()=>[d(u(f.typeName),1)]),_:2},1024),I("div",fe,[(m(!0),x(z,null,B(f.qList,h=>(m(),E(l,{type:h.displayType,class:"question-button",onClick:Ne=>N(h.index)},{default:a(()=>[d(u(h.index+1),1)]),_:2},1032,["type","onClick"]))),256))])]))),256))]),_:1})]),_:1}),o(j,null,{default:a(()=>[I("div",ye,[t.meta.index>=0?(m(),x("div",ge,"【考生答案】"+u(t.meta.userAnswer),1)):g("",!0),e.state==p(c).FINISHED&&t.meta.index>=0?(m(),x("div",we," 【正确答案】"+u(t.meta.answer),1)):g("",!0),t.meta.index>=0?(m(),E($,{key:2},{default:a(()=>[o(l,{disabled:t.meta.index==0,type:"primary",icon:p(W),size:"small",onClick:s[0]||(s[0]=f=>N(t.meta.index-1))},{default:a(()=>[d("上一题")]),_:1},8,["disabled","icon"]),o(l,{disabled:t.meta.index==p(y).length-1,type:"primary",size:"small",onClick:s[1]||(s[1]=f=>N(t.meta.index+1))},{default:a(()=>[d("下一题"),o(M,{class:"el-icon--right"},{default:a(()=>[o(S)]),_:1})]),_:1},8,["disabled"])]),_:1})):g("",!0),t.meta.type==p(_).CHOICE&&e.state==p(c).ONGOING?(m(),E(k,{key:3,modelValue:t.answers[0],"onUpdate:modelValue":s[2]||(s[2]=f=>t.answers[0]=f),onChange:G},{default:a(()=>[o(w,{label:"A",size:"small"},{default:a(()=>[d("A")]),_:1}),o(w,{label:"B",size:"small"},{default:a(()=>[d("B")]),_:1}),o(w,{label:"C",size:"small"},{default:a(()=>[d("C")]),_:1}),o(w,{label:"D",size:"small"},{default:a(()=>[d("D")]),_:1})]),_:1},8,["modelValue"])):g("",!0),t.meta.type==p(_).LOGIC&&e.state==p(c).ONGOING?(m(),E(k,{key:4,modelValue:t.answers[1],"onUpdate:modelValue":s[3]||(s[3]=f=>t.answers[1]=f),onChange:G},{default:a(()=>[o(w,{label:"T",size:"small"},{default:a(()=>[d("正确")]),_:1}),o(w,{label:"F",size:"small"},{default:a(()=>[d("错误")]),_:1})]),_:1},8,["modelValue"])):g("",!0)]),I("div",Ee,[t.meta.index>=0?(m(),x("div",xe,u(t.meta.index+1)+". ("+u(t.meta.score)+"分)"+u(t.meta.title),1)):g("",!0),t.meta.image!=null?(m(),E(H,{key:1,src:t.meta.image,fit:"scale-down"},null,8,["src"])):g("",!0),I("div",null,u(t.meta.description),1)])]),_:1})]),_:1})]),_:1})}}});const Te=te(be,[["__scopeId","data-v-20f1b3af"]]);export{Te as default};
